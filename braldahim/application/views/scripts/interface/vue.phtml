<? include("box_header.phtml") ?>
<div class="inner">
<? if ($this->affichageInterne == true) :
	if ($this->estVueEtendue == false) {
		include('vue/titre_vue.phtml'); 
	} else {
		?><ul class="titre textalic textsizea">Ma Vue &Eacute;tendue</ul>
		<ul class="titre textalic textsizef">
		<?=$this->vue_nb_cases ?> case<? if ($this->vue_nb_cases > 1): echo "s"; endif; ?>
		aux alentours
		</ul><?
	}
?>
<div class="contenuC">
  	<ul class="box_contenu1 textalic">
  	&nbsp;
    <table class='vue2d' align='center'>
	     
     <?php 
     $col="";
     
     echo "<tr><td>&nbsp;</td>";
     foreach($this->tableau as $k => $case) :
     	
    	if ($case["change_level"] == 1 && $col == "ok") :
    		break;
    	endif;
    	echo "<td>".$case["x"]."</td>";
    	if ($case["change_level"] == true) : 
          $col="ok";
        endif;
	 endforeach;
	 echo "</tr>";
		 
	$col="";
	foreach($this->tableau as $k => $case) : ?>
	<? 
		$textVille = "";
		if (!empty($case["ville"])) :
      		$textVille = " - Ville : ".htmlspecialchars($case["ville"]["nom_ville"]);
      		if ($case["ville"]["est_capitale"] === true) {
      			$textVille .= " - Capitale";
      		}
      		$textVille .= ", R&eacute;gion : ".htmlspecialchars($case["ville"]["nom_region"]);
      	endif;
      ?>
      		
	<?php 
	if ($case["change_level"] == 1 && $col == "ok") :
		echo "</tr>";
	endif; ?>
	<?php if ($case["change_level"] == true) : 
		$col="ok"; ?>
		<tr nowrap><td><?=$case["y"]?></td>
    <?php endif; ?>
	<td class='vue2d <?=$case["css"] ?> <?=$case["css_actuelle"]?>' nowrap title="<?=$case["x"]. "," . $case["y"]." ".$textVille?>">
			
		<table>
			<tr>
				<td width="32px" height="32px"><? include('vue/hobbits_monstres.phtml');ob_flush();?></td>
				<td width="32px"  height="32px"><? include('vue/lieux_palissades_routes_echoppes.phtml');ob_flush();?></td>
			</tr>
			<tr>
				<td width="32px"  height="32px"><? include('vue/cadavres_castars_runes.phtml'); ob_flush(); ?>
				</td>
				<td width="32px"  height="32px"><? include('vue/elements_charrettes.phtml'); ob_flush();?>
				<? include('vue/cases.phtml');?>
				</td>
			</tr>
		</table>
		<?
		$case = null;
		unset($this->tableau[$k]);
		ob_flush();
		?>
		</td>
     <?php endforeach; ?>
     </tr>
    </table>
    &nbsp;
    </ul>
 </div>
<? else: ?>
	Chargement de la vue en cours
	<br /><img src="/public/images/wait.gif" />
<? endif; ?>
</div>
<? include("box_bottom.phtml") ?>