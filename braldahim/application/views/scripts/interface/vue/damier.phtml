<table class='vue2d' align='center'>
     <?php 
     $col="";
     
     echo "<tr><td>&nbsp;</td>";
     foreach($this->tableau as $k => $case) :
     
    if ($case["change_level"] == 1 && $col == "ok") :
    	break;
    endif;
    echo "<td>".$case["x"]."</td>";
    if ($case["change_level"] == true) : 
          $col="ok";
        endif;
 endforeach;
 echo "</tr>";
	 
$col="";
foreach($this->tableau as $k => $case) :
	$textVille = "";
	if (!empty($case["ville"])) :
		$textVille = " - Ville : ".htmlspecialchars($case["ville"]["nom_ville"]);
		if ($case["ville"]["est_capitale"] === true) {
			$textVille .= " - Capitale";
		}
		$textVille .= ", R&eacute;gion : ".htmlspecialchars($case["ville"]["nom_region"]);
	endif;
	$titre = "Position : ".$case["x"].", ".$case["y"];
      	
	if ($case["change_level"] == 1 && $col == "ok") :
		echo "</tr>";
	endif; 
	
	if ($this->user->administrationvue == true) {
		$adminDoubleClickLieu = "OnDblClick=\"Javascript:_get_('/administrationajax/doaction?caction=ask_administrationajax_insererlieu&xy_lieu=".$case["x"]."h".$case["y"]."');\" title='Double-Cliquez pour insérer un nouveau lieu'";
		$adminDoubleClickRoute = "OnDblClick=\"Javascript:_get_('/administrationajax/doaction?caction=ask_administrationajax_insererroute&xy_route=".$case["x"]."h".$case["y"]."');\" title='Double-Cliquez pour insérer une nouvelle route'";
	} else {
		$adminDoubleClickLieu = "";
		$adminDoubleClickRoute = "";
	}
	
	$textPalissade = "";
	if ($case["n_palissades"] > 0) :
      	$textPalissade = "<br>Palissade : <br>";
      	foreach($case["palissades"] as $p) {
      		$textPalissade .= "1 palissade (n&deg; ".htmlspecialchars($p["id_palissade"]).")";
      		if ($p["est_destructible_palissade"] == "oui") {
      			$textPalissade .= " destructible";
      		} else {
      			$textPalissade .= " indestructible";
      		}
      		$textPalissade .= "<br />";
		} 
		$s = "";
		if ($case["n_palissades"] > 1) {
			$s = "s";
		}
	endif;
	
	?>
	<?php if ($case["change_level"] == true) : 
		$col="ok"; ?>
		<tr nowrap><td><?=$case["y"]?></td>
    <?php endif; ?>
	<td class='vue2d <?=$case["css"] ?> <?=$case["css_actuelle"]?>' nowrap title="<?=$case["x"]. "," . $case["y"]." ".$textVille?>">
	
	<div class="cases <?=$case["css_actuelle"]?>" <? if ($textPalissade != "") : echo Bral_Helper_Tooltip::jsTip($textPalissade, $titre); endif; ?>>
		<table class="cases <?=$case["css_actuelle"]?>">
		<tr>
		<td class="cases <?=$case["css_actuelle"]?>"><? include('hobbits_monstres.phtml');ob_flush();?></td>
		<td class="cases <?=$case["css_actuelle"]?>" <?=$adminDoubleClickLieu?>><? include('lieux_palissades_echoppes.phtml');ob_flush();?></td>
		</tr>
		<tr>
		<td class="cases <?=$case["css_actuelle"]?>" <?=$adminDoubleClickRoute?>><? include('cadavres_castars_runes.phtml'); ob_flush(); ?></td>
		<td class="cases <?=$case["css_actuelle"]?>"><? include('elements_charrettes.phtml'); ob_flush();?><? include('cases.phtml');?></td>
		</tr>
		</table>
	</div>
	<?
	$case = null;
	unset($this->tableau[$k]);
	ob_flush();
	?>
	</td>
<?php endforeach; ?>
</tr>
</table>
&nbsp;